/*
 *  (C) Copyright 2020 Draeger and Licensors, info@draeger.com
 *  Based on work by Russell King
 *
 *  SPDX-License-Identifier: GPL-2.0+
 *  Device Tree file for Drager M48 Board
 */
#include <dt-bindings/clock/imx6qdl-clock.h>
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>

&iomuxc {

	m48 {

		pinctrl_m48_uart1: m48-uart1 {
			fsl,pins = <
				MX6QDL_PAD_SD3_DAT7__UART1_TX_DATA	0x1b0b0
				MX6QDL_PAD_SD3_DAT6__UART1_RX_DATA	0x1b0b0
			>;
		};

		pinctrl_m48_hdmi: m48-hdmi {
			fsl,pins = <
				MX6QDL_PAD_EIM_D16__HDMI_TX_DDC_SDA 0x1b0b0
				MX6QDL_PAD_EIM_EB2__HDMI_TX_DDC_SCL 0x1b0b0
			>;
		};

		pinctrl_m48_lvds: m48-lvds {
			fsl,pins = <
				MX6QDL_PAD_EIM_A22__GPIO2_IO16 0x1b010 /* DISPLAY_EN */
				MX6QDL_PAD_EIM_A20__GPIO2_IO18 0x1b010 /* BACKLIGHT_EN */
				MX6QDL_PAD_EIM_A18__GPIO2_IO20 0x1b010 /* DISP0_CONTRAST */
			>;
		};

		pinctrl_m48_i2c2: m48-i2c2 {
			fsl,pins = <
				MX6QDL_PAD_KEY_COL3__I2C2_SCL 0x4001b820
				MX6QDL_PAD_KEY_ROW3__I2C2_SDA 0x4001b820
			>;
		};

		pinctrl_m48_i2c2_gpio: m48-i2c2_gpio {
			fsl,pins = <
				MX6QDL_PAD_KEY_COL3__GPIO4_IO12 0x1b820
				MX6QDL_PAD_KEY_ROW3__GPIO4_IO13 0x1b820
			>;
#define GP_I2C2_SCL	<&gpio4 12 GPIO_ACTIVE_HIGH>
#define GP_I2C2_SDA	<&gpio4 13 GPIO_ACTIVE_HIGH>
		};

		pinctrl_m48_i2c3: m48-i2c3 {
			fsl,pins = <
				MX6QDL_PAD_EIM_D17__I2C3_SCL 0x4001b820
				MX6QDL_PAD_EIM_D18__I2C3_SDA 0x4001b820
			>;
		};

		pinctrl_m48_i2c3_gpio: m48-i2c3_gpio {
			fsl,pins = <
				MX6QDL_PAD_EIM_D17__GPIO3_IO17 0x1b820
				MX6QDL_PAD_EIM_D18__GPIO3_IO18 0x1b820
			>;
#define GP_I2C3_SCL	<&gpio3 17 GPIO_ACTIVE_HIGH>
#define GP_I2C3_SDA	<&gpio3 18 GPIO_ACTIVE_HIGH>
		};

		pinctrl_m48_usdhc3: m48-usdhc3 {
			fsl,pins = <
				MX6QDL_PAD_SD3_CMD__SD3_CMD    0x1B060
				MX6QDL_PAD_SD3_CLK__SD3_CLK    0x1B060
				MX6QDL_PAD_SD3_DAT0__SD3_DATA0 0x1B060
				MX6QDL_PAD_SD3_DAT1__SD3_DATA1 0x1B060
				MX6QDL_PAD_SD3_DAT2__SD3_DATA2 0x1B060
				MX6QDL_PAD_SD3_DAT3__SD3_DATA3 0x1B060
			>;
		};

		pinctrl_m48_enet: enetgrp {
			fsl,pins = <
				MX6QDL_PAD_KEY_COL1__ENET_MDIO			0x1b0b0
				MX6QDL_PAD_ENET_MDC__ENET_MDC			0x1b0b0
				MX6QDL_PAD_RGMII_TXC__RGMII_TXC			0x13018
				MX6QDL_PAD_RGMII_TD0__RGMII_TD0			0x1B018
				MX6QDL_PAD_RGMII_TD1__RGMII_TD1			0x1B018
				MX6QDL_PAD_RGMII_TD2__RGMII_TD2			0x1B018
				MX6QDL_PAD_RGMII_TD3__RGMII_TD3			0x1B018
				MX6QDL_PAD_RGMII_TX_CTL__RGMII_TX_CTL		0x13018
				MX6QDL_PAD_ENET_REF_CLK__ENET_TX_CLK		0x1b0b0
				MX6QDL_PAD_RGMII_RXC__RGMII_RXC			0x13030
				MX6QDL_PAD_RGMII_RD0__RGMII_RD0			0x1B030
				MX6QDL_PAD_RGMII_RD1__RGMII_RD1			0x1B030
				MX6QDL_PAD_RGMII_RD2__RGMII_RD2			0x1B030
				MX6QDL_PAD_RGMII_RD3__RGMII_RD3			0x1B030
				MX6QDL_PAD_RGMII_RX_CTL__RGMII_RX_CTL		0x13030
				MX6QDL_PAD_CTL_GRP_DDR_TYPE_RGMII		0x80000000
				MX6QDL_PAD_CTL_GRP_RGMII_TERM			0x80000000
			>;
		};
	};
};

&i2c2 {
	clock-frequency = <100000>;
	pinctrl-names = "default", "gpio";
	pinctrl-0 = <&pinctrl_m48_i2c2>;
	pinctrl-1 = <&pinctrl_m48_i2c2_gpio>;
	scl-gpios = GP_I2C2_SCL;
	sda-gpios = GP_I2C2_SDA;
	status = "okay";

	eeprom_mac: eeprom@50 {
		compatible = "atmel,24c08";
		reg = <0x50>;
		pagesize = <16>;
	};
};

&i2c3 {
	pinctrl-names = "default", "gpio";
	pinctrl-0 = <&pinctrl_m48_i2c3>;
	pinctrl-1 = <&pinctrl_m48_i2c3_gpio>;
	scl-gpios = GP_I2C3_SCL;
	sda-gpios = GP_I2C3_SDA;
	status = "okay";
};

&uart1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_m48_uart1>;
	status = "okay";
};

&usdhc3 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_m48_usdhc3>;
	non-removable;
	fsl,wp-controller;
	status = "okay";
};

&fec {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_m48_enet>;
	phy-mode = "rgmii-id";
	phy-handle = <&ethphy>;
	status = "okay";

	mdio {
		#address-cells = <1>;
		#size-cells = <0>;

		ethphy: ethernet-phy@0 {
			reg = <0>;
			rxc-skew-ps = <1380>;
			rxd0-skew-ps = <0>;
			rxd1-skew-ps = <0>;
			rxd2-skew-ps = <0>;
			rxd3-skew-ps = <0>;
			rxdv-skew-ps = <0>;
			txc-skew-ps = <1860>;
			txd0-skew-ps = <0>;
			txd1-skew-ps = <0>;
			txd2-skew-ps = <0>;
			txd3-skew-ps = <0>;
			txen-skew-ps = <0>;
			status = "okay";
		};
	};
};

&hdmi {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_m48_hdmi>;

	display-timings {
		native-mode = <&hdmi0>;
		hdmi0: hdmi {
			clock-frequency = <65000000>;
			hactive = <1024>;
			vactive = <768>;
			hback-porch = <220>;
			hfront-porch = <40>;
			vback-porch = <21>;
			vfront-porch = <7>;
			hsync-len = <60>;
			vsync-len = <10>;
		};
		hdmi1: hdmi-1280x800-24@60 {
			clock-frequency = <71000000>;
			hactive = <1280>;
			vactive = <800>;
			hback-porch = <80>;
			hfront-porch = <48>;
			vback-porch = <14>;
			vfront-porch = <3>;
			hsync-len = <32>;
			vsync-len = <6>;
		};
		hdmi2: hdmi-1366x768-32@60 {
			clock-frequency = <72000000>;
			hactive = <1366>;
			vactive = <768>;
			hback-porch = <80>;
			hfront-porch = <48>;
			vback-porch = <14>;
			vfront-porch = <3>;
			hsync-len = <32>;
			vsync-len = <5>;
        };
	};
};

&ldb {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_m48_lvds>;

	lvds-channel@0 {
		fsl,data-mapping = "spwg";
		fsl,data-width = <24>;
		status = "okay";

		display-timings {
			native-mode = <&timing0>;
			timing0: 1366x768-32@60 {
				clock-frequency = <72000000>;
				hactive = <1366>;
				vactive = <768>;
				hback-porch = <80>;
				hfront-porch = <48>;
				vback-porch = <14>;
				vfront-porch = <3>;
				hsync-len = <32>;
				vsync-len = <5>;
			};
			timing1: 1280x800-24@60 {
				clock-frequency = <71000000>;
				hactive = <1280>;
				vactive = <800>;
				hback-porch = <80>;
				hfront-porch = <48>;
				vback-porch = <14>;
				vfront-porch = <3>;
				hsync-len = <32>;
				vsync-len = <6>;
			};
			timing2: Tianma_1280x800-24@60 {
				clock-frequency = <67254000>;
				hactive = <1280>;
				vactive = <800>;
				hback-porch = <5>;
				hfront-porch = <27>;
				vback-porch = <2>;
				vfront-porch = <26>;
				hsync-len = <32>;
				vsync-len = <6>;
			};
			timing3: 1024x768-24@60 {
				clock-frequency = <65000000>;
				hactive = <1024>;
				vactive = <768>;
				hback-porch = <160>;
				hfront-porch = <24>;
				vback-porch = <29>;
				vfront-porch = <3>;
				hsync-len = <136>;
				vsync-len = <6>;
			};
			timing4: 800x600-32@60 {
				clock-frequency = <40000000>;
				hactive = <800>;
				vactive = <600>;
				hback-porch = <120>;
				hfront-porch = <40>;
				vback-porch = <28>;
				vfront-porch = <13>;
				hsync-len = <80>;
				vsync-len = <4>;
			};
			timing5: 640x480-24@60 {
				clock-frequency = <25175000>;
				hactive = <640>;
				vactive = <480>;
				hback-porch = <48>;
				hfront-porch = <16>;
				vback-porch = <33>;
				vfront-porch = <10>;
				hsync-len = <96>;
				vsync-len = <2>;
			};
		};
	};
};


/ {
	aliases {
		mmc0 = &usdhc3;
		mmc1 = &usdhc4;
		eeprom_mac = &eeprom_mac;
	};

	/* Will be filled by the bootloader */
	memory@10000000 {
		device_type = "memory";
		reg = <0x10000000 0x80000000>;
	};

	chosen {
		stdout-path = &uart1;
	};

	config {
	   bootcmd = "startM48";
	};
};


