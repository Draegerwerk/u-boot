/*
 * mx6m48dl_spl_cfg.c
 *
 * SPDX-License-Identifier:        GPL-2.0+
 *
 * (C) Copyright 2015 Draeger and Licensors, info@draeger.com
 *
 */

#define CONFIG_MX6DL
#include <common.h>
#include <asm/arch/mx6-ddr.h>
#include <asm/arch/mx6dl-ddr.h>
#include "mx6m48_spl_cfg.h"

m48_configuration ddr_setup_mx6dl [] =
{
 /***********************************/
 /* IOMUX                           */
 /***********************************/
  {MX6_IOM_DRAM_SDQS0, 0x00000030},
 {MX6_IOM_DRAM_SDQS1, 0x00000030},
 {MX6_IOM_DRAM_SDQS2, 0x00000030},
 {MX6_IOM_DRAM_SDQS3, 0x00000030},
 {MX6_IOM_DRAM_SDQS4, 0x00000030},
 {MX6_IOM_DRAM_SDQS5, 0x00000030},
 {MX6_IOM_DRAM_SDQS6, 0x00000030},
 {MX6_IOM_DRAM_SDQS7, 0x00000030},

 {MX6_IOM_GRP_B0DS, 0x00000030},
 {MX6_IOM_GRP_B1DS, 0x00000030},
 {MX6_IOM_GRP_B2DS, 0x00000030},
 {MX6_IOM_GRP_B3DS, 0x00000030},
 {MX6_IOM_GRP_B4DS, 0x00000030},
 {MX6_IOM_GRP_B5DS, 0x00000030},
 {MX6_IOM_GRP_B6DS, 0x00000030},
 {MX6_IOM_GRP_B7DS, 0x00000030},
 {MX6_IOM_GRP_ADDDS, 0x00000030},
 {MX6_IOM_GRP_CTLDS, 0x00000030},

 {MX6_IOM_DRAM_DQM0, 0x00000030},
 {MX6_IOM_DRAM_DQM1, 0x00000030},
 {MX6_IOM_DRAM_DQM2, 0x00000030},
 {MX6_IOM_DRAM_DQM3, 0x00000030},
 {MX6_IOM_DRAM_DQM4, 0x00000030},
 {MX6_IOM_DRAM_DQM5, 0x00000030},
 {MX6_IOM_DRAM_DQM6, 0x00000030},
 {MX6_IOM_DRAM_DQM7, 0x00000030},

 {MX6_IOM_DRAM_CAS, 0x00000030},
 {MX6_IOM_DRAM_RAS, 0x00000030},
 {MX6_IOM_DRAM_SDCLK_0, 0x00000030},
 {MX6_IOM_DRAM_SDCLK_1, 0x00000030},

 {MX6_IOM_DRAM_RESET, 0x00000030},
 {MX6_IOM_DRAM_SDCKE0, 0x00020000},
 {MX6_IOM_DRAM_SDCKE1, 0x00020000},

 {MX6_IOM_DRAM_SDODT0, 0x00000030},
 {MX6_IOM_DRAM_SDODT1, 0x00000030},

 {MX6_IOM_DDRMODE_CTL, 0x00020000},
 {MX6_IOM_GRP_DDRMODE, 0x00020000},
 {MX6_IOM_GRP_DDRPKE, 0x00000000},
 {MX6_IOM_DRAM_SDBA0, 0x00000000},
 {MX6_IOM_DRAM_SDBA1, 0x00000000},
 {MX6_IOM_DRAM_SDBA2, 0x00000000},
 {MX6_IOM_GRP_DDR_TYPE, 0x000C0000},

 /***********************************/
 /* DDR Controller                  */
 /***********************************/

 /* MDSCR    con_req */
 {MX6_MMDC_P0_MDSCR, 0x00008000},

 {MX6_MMDC_P0_MPZQHWCTRL, 0xA1390003},
 {MX6_MMDC_P1_MPZQHWCTRL, 0xA1390003},

};
int ddr_setup_mx6dl_size = ARRAY_SIZE(ddr_setup_mx6dl);


m48_configuration ram_setup_mx6dl [] =
{
 {MX6_MMDC_P0_MPRDDQBY0DL, 0x33333333},
 {MX6_MMDC_P0_MPRDDQBY1DL, 0x33333333},
 {MX6_MMDC_P0_MPRDDQBY2DL, 0x33333333},
 {MX6_MMDC_P0_MPRDDQBY3DL, 0x33333333},
 {MX6_MMDC_P1_MPRDDQBY0DL, 0x33333333},
 {MX6_MMDC_P1_MPRDDQBY1DL, 0x33333333},
 {MX6_MMDC_P1_MPRDDQBY2DL, 0x33333333},
 {MX6_MMDC_P1_MPRDDQBY3DL, 0x33333333},

 /* A recent recommendation was added for i.mx6DQ Rev C or later Devices
 This has been seen to improve measured duty cycle by setting fine tune SDCLK duty cyc to low.
 If you are not experiencing issues, you could leave this commented out. (added by NXP)
 */
 {0x021b08c0, 0x24921492}, /* MMDC1_MPDCCR */
 {0x021b48c0, 0x24921492}, /* MMDC2_MPDCCR */

 /* CL: 13,91 ns * 396 MHZ = 5,51 -> 6 CK */

 {MX6_MMDC_P0_MDPDC,  0x0002002D},

 /* tRFC(4GB)=243*1.07ns=260ns */
 /* RFC=260ns / 396 MHz = 103 */
 /* RFC=103; XS=107; XP=3; XPDLL=10; FAW=16; CL=6 -> SDRAM MR0;  */
 {MX6_MMDC_P0_MDCFG0, 0x666B52F3},

 /* RCD=6; RP=6; RC=19; RAS=15; RPA=1; WR=6->SDRAM MR0; */
 /* MRD=12; CWL=5 -> SDRAM MR2 */
 {MX6_MMDC_P0_MDCFG1, 0xB64E8B63},
 /* RRD=4; WTR=4; RTP=4; DLLK=512 */
 {MX6_MMDC_P0_MDCFG2, 0x01FF00DB},
 /* ODT_idle_off=3 (AL=0); ODTLon=3; AXPD=4 (CWL-1) */
 /* ANPD=4 (CWL-1); AONPD=2; AOFPD=2 */
 {MX6_MMDC_P0_MDOTC,  0x09333030},

 /* RL=AL+CL */
 /* RTW=AL+CL+CCD-CWL+2CK=0+6+4-6+2=6  */
 /* RTW_SAME = RTW-AL-(CL-CWL)-BL/2 = 6-0-(6-4)-(8/2) = 2 */
 {MX6_MMDC_P0_MDRWD, 0x000026D2},

 /* CALIB_PER_CS=0 (CS0); ADDR_MIRROR=1; LHD=0; WALAT=1*/
 /* BI_ON=1; LPDDR2_S2=0; MIF3_MODE=3; RALAT=0 (AL) */
 /* DDR_4_BANK=0; DDR_TYPE=0; LPDDR2_2CH=0; RST=0; */
 {MX6_MMDC_P0_MDMISC, 0x00011740},
 /* XPR=RFC+10ns=103+4=107; SDE_to_RST=14(JEDEC); RST_toCKE=33(JEDEC); */
 {MX6_MMDC_P0_MDOR,  0x006A1023},
 {MX6_MMDC_P0_MDASP, 0x00000047},

 /* configure density and burst lenght */
 {MX6_MMDC_P0_MDCTL, 0x041A0000},

 /* start ZQ calibration */
 {MX6_MMDC_P0_MDCTL, 0x841A0000},
 {MX6_MMDC_P0_MDSCR, 0x04008032},
 {MX6_MMDC_P0_MDSCR, 0x00008033},
 /* SDRAM MR1: AL=0 == MDCFG2 */
 {MX6_MMDC_P0_MDSCR, 0x00428031},
 /* SDRAM MR0: CL=6 == MDPDC */
 {MX6_MMDC_P0_MDSCR, 0x13208030},
 {MX6_MMDC_P0_MDSCR, 0x04008040},

 {MX6_MMDC_P0_MDPDC, 0x0002556D},
 {MX6_MMDC_P0_MAPSR, 0x00001006},


 {MX6_MMDC_P0_MDREF, 0x00001800},

 {MX6_MMDC_P0_MPODTCTRL, 0x00022227},
 {MX6_MMDC_P1_MPODTCTRL, 0x00022227},

 {MX6_MMDC_P0_MPMUR0, 0x00000800},
 {MX6_MMDC_P1_MPMUR0, 0x00000800},

 {MX6_MMDC_P0_MDSCR, 0x00000000},
};
int ram_setup_mx6dl_size = ARRAY_SIZE(ram_setup_mx6dl);

m48_configuration ram_calibration_mx6dl_06 [] =
{
 {MX6_MMDC_P0_MPWLDECTRL0, 0x001F001F},
 {MX6_MMDC_P0_MPWLDECTRL1, 0x001F001F},
 {MX6_MMDC_P1_MPWLDECTRL0, 0x001F001F},
 {MX6_MMDC_P1_MPWLDECTRL1, 0x001F001F},
 {MX6_MMDC_P0_MPDGCTRL0, 0x42580258},
 {MX6_MMDC_P0_MPDGCTRL1, 0x0244024C},
 {MX6_MMDC_P1_MPDGCTRL0, 0x424C0250},
 {MX6_MMDC_P1_MPDGCTRL1, 0x02300244},
 {MX6_MMDC_P0_MPRDDLCTL, 0x444A484A},
 {MX6_MMDC_P1_MPRDDLCTL, 0x44484C40},
 {MX6_MMDC_P0_MPWRDLCTL, 0x12123434},
 {MX6_MMDC_P1_MPWRDLCTL, 0x3C34142E},
};
int ram_calibration_mx6dl_size_06 = ARRAY_SIZE(ram_calibration_mx6dl_06);

m48_configuration ram_calibration_mx6dl_08 [] =
{
 {MX6_MMDC_P0_MPWLDECTRL0, 0x00660071},
 {MX6_MMDC_P0_MPWLDECTRL1, 0x0057005B},
 {MX6_MMDC_P1_MPWLDECTRL0, 0x00490050},
 {MX6_MMDC_P1_MPWLDECTRL1, 0x0039004D},
 {MX6_MMDC_P0_MPDGCTRL0, 0x42570254},
 {MX6_MMDC_P0_MPDGCTRL1, 0x0234023C},
 {MX6_MMDC_P1_MPDGCTRL0, 0x42420248},
 {MX6_MMDC_P1_MPDGCTRL1, 0x02250234},
 {MX6_MMDC_P0_MPRDDLCTL, 0x44454847},
 {MX6_MMDC_P1_MPRDDLCTL, 0x46474843},
 {MX6_MMDC_P0_MPWRDLCTL, 0x38363031},
 {MX6_MMDC_P1_MPWRDLCTL, 0x3C363831},
};
int ram_calibration_mx6dl_size_08 = ARRAY_SIZE(ram_calibration_mx6dl_08);
